(self.webpackChunk=self.webpackChunk||[]).push([[6132],{22283:(e,t,i)=>{i.r(t),i.d(t,{ActivationSystemFeatureImpl:()=>k});var n=i(10980),a=i(34124),s=i(74525),o=i(25394),l=i(48765),r=i(96031),m=i(68665),c=i(57945),p=i(77141),h=i(89883),u=i(94956),d=i(88689),_=i(48983),g=i(80223),f=i(36120),b=i(94489);const P=({descriptionText:e,ctaText:t,onCtaClick:i,onDismiss:n,onMount:a,emotion:s,placementInfo:o})=>{const{referenceElement:l,placement:r,modifiers:c}=o,[p,P]=m.useState(null),{styles:v,attributes:y}=(0,h.D)(l,p,{placement:r,modifiers:c});return g.P.useEffectOnDidMount(a),m.createElement("div",{ref:P,className:u.inlinePill,style:v.popper,"data-test-attr":"inline-activation-pill",...y.popper},m.createElement(d.P,{size:"small","aria-label":"Dismiss",className:u.inlinePillCloseButton,onClick:n}),m.createElement(b.x,{as:"span",variant:"text-small",className:u.inlinePillDescriptionText},e),s&&m.createElement(_.dy,{size:"small-medium",unicodeHexArray:[s.emojiId],unicodeLiteral:s.emoji,className:u.inlinePillEmoji,"aria-hidden":"true"}),m.createElement(f.zx.Ghost,{className:u.inlinePillCTA,onClick:i},t))};var v=i(95745),y=i(13058);const S={cta:"See more in Grammarly",emotionHook:e=>`Sounding ${e}`};var C;!function(e){e.MINIMUM_TONE_COUNT=3,e.MINIMUM_TONE_CONFIDENCE=.5}(C||(C={}));var E=i(43801),T=i(82366),I=i(12416);class k{constructor(e){this._params=e,this._subs=new n.w,this._log=p.Y.create("ActivationSystemFeatureImpl"),this._emogenieState=r.h.create({prevalentEmotion:o.YP,allEmotions:o.YP}),this._areOtherGrammarlyPopupsOpen=r.h.create(!1),this._fieldContainer=o.YP,this._composeFieldContainer=o.YP,this._isCompose=!1,this._toolbarInfo=r.h.create(o.YP),this._inlinePillPlacement=r.h.create(o.YP),this._isMinimized=r.h.create(!1),this._createToolbarInfoSubscription=()=>(0,y.zG)(this._fieldContainer,o.UI(T.x.createToolbarVisibleObservable),o.fS((0,y.a9)(a.of(null)))).subscribe((e=>{(0,y.zG)(e,o.ij,s.wW(this._toolbarInfo))})),this._createIsMinimizedSubscription=()=>(0,y.zG)(this._composeFieldContainer,o.hX((()=>this._isCompose)),o.UI(T.x.createMinimizableComposeContainerVisibilityObservable),o.fS((0,y.a9)(a.of(null)))).subscribe((e=>{(0,y.zG)(e,o.ij,o.UI((e=>!e.visible)),o.fS((()=>!1)),s.wW(this._isMinimized))})),this._createInlinePillPlacementAtom=()=>r.h.combine(this._toolbarInfo,this._isMinimized,((e,t)=>(0,y.zG)(o.Do,o.ak("toolbar",(()=>e)),o.ak("sendButtonContainer",(()=>this._sendButtonContainer)),o.hX((()=>!t)),o.UI((({toolbar:e,sendButtonContainer:t})=>{const i=e.visible?e.el:t,n=e.visible?8:20;return(0,I.tw)(i,n)}))))),this._createEmogenieStateSubscription=()=>this._params.emogenieService.viewState.view(l.H6("report","prevalentEmotion")).subscribe((0,y.ls)((({report:e,prevalentEmotion:t})=>({allEmotions:o.ij(null==e?void 0:e.emotions),prevalentEmotion:o.ij(t)})),s.wW(this._emogenieState))),this._createGrammarlyPopupsOpenSubscription=()=>r.h.combine(this._params.assistantDynamicService.assistantOpenState.view((e=>"open"===e)),this._params.cheetahDynamicService.assistantState.view((e=>"opened"===e.kind)),this._params.gButtonPopupState.view((e=>"none"!==e.type)),((e,t,i)=>e||t||i)).subscribe(s.wW(this._areOtherGrammarlyPopupsOpen)),this._resetActivationState=()=>{this._params.actions._resetActivationSystemSettings()},this._onInlinePillCTAClick=()=>{this._log.debug("Inline pill CTA clicked"),this._params.gnar.activationSystemInlinePillCtaClick("inlinePill"),this._params.openEmogenieReport({type:v.WT.activationSystem}),this._params.actions.setActivationSystemToneInlinePillCTAClicked().then((()=>{this.dispose()}))},this._onDismissInlinePill=()=>{this._log.debug("Dismissing inline pill"),this._params.gnar.activationSystemInlinePillDismissClick("inlinePill"),this._params.actions.setActivationSystemToneInlinePillDismissed().then((()=>{this.dispose()}))},this._onInlinePillShown=()=>{this._log.debug("Inline pill shown"),this._params.gnar.activationSystemInlinePillPopupShow(),this._params.actions.setActivationSystemToneInlinePillSeen()},this._textHasSufficientEmotionsToRenderPill=(e,t)=>e.length>=C.MINIMUM_TONE_COUNT&&t.confidence>=C.MINIMUM_TONE_CONFIDENCE,this._fieldContainer=I.jK(this._params.textField),this._composeFieldContainer=I.cY(this._params.textField),this._sendButtonContainer=I.cB(this._params.textField),this._isCompose=I.mh(this._composeFieldContainer),this._subs.add(this._createToolbarInfoSubscription()),this._subs.add(this._createIsMinimizedSubscription()),this._inlinePillPlacement=this._createInlinePillPlacementAtom(),this._subs.add(this._inlinePillPlacement.subscribe()),this._subs.add(this._createEmogenieStateSubscription()),this._subs.add(this._createGrammarlyPopupsOpenSubscription())}get inlinePillUI(){const{cta:e,emotionHook:t}=S;return r.h.combine(this._emogenieState,this._areOtherGrammarlyPopupsOpen,this._params.csPageState.view("activationSystem"),this._params.user,this._params.checkingStatus,this._inlinePillPlacement,((i,n,a,s,l,r)=>(0,y.zG)(o.Do,o.hX((()=>!(0,I.Zl)(a))),o.ak("allEmotions",(()=>i.allEmotions)),o.ak("prevalentEmotion",(()=>i.prevalentEmotion)),o.ak("inlinePillPlacement",(()=>r)),o.hX((({allEmotions:e,prevalentEmotion:t})=>this._textHasSufficientEmotionsToRenderPill(e,t))),o.hX((()=>s.anonymous)),o.hX((()=>!n)),o.hX((()=>"test"===this._params.experimentClient.getTreatment(E.p.AspToneInlinePillGmail))),o.g_(y.gn,(({prevalentEmotion:i,inlinePillPlacement:n})=>m.createElement(P,{ctaText:e,descriptionText:t(i.name.toLowerCase()),onCtaClick:this._onInlinePillCTAClick,onDismiss:this._onDismissInlinePill,onMount:this._onInlinePillShown,placementInfo:n,emotion:i,checkingInProgress:l===c.Hq.inProgress}))))))}dispose(){this._log.debug("Disposing"),this._subs.unsubscribe()}}},94956:e=>{e.exports={inlinePill:"BYavB",fadeIn:"zG7Sj",inlinePillCloseButton:"qkYqs",inlinePillDescriptionText:"sRTeW",inlinePillCTA:"UPAxJ",spin:"UclXr"}},36120:(e,t,i)=>{i.d(t,{L_:()=>d,RZ:()=>_,zx:()=>u});var n=i(5535),a=i(75666),s=i(68665),o=i(54281),l=i(21577),r=i(76326),m=i(87417),c=i(92127),p=i(55001),h=i(39836);function u(e){return s.createElement(p.Y,d(e,h.LI))}function d(e,t){var i=(0,l.Sh)(e.className,t).className;return(0,a._)((0,n._)({},e),{className:i})}!function(e){var t=e.Animated=function(e){return s.createElement(p.Y,(0,a._)((0,n._)({},e),{animationMode:Boolean(e.animationMode)?e.animationMode:m.m.FromClickPoint}))};e.Primary=function(e){return s.createElement(t,(0,n._)({styleType:c.Z.Type.Button},d(e,h.T$)))},e.Secondary=function(e){return s.createElement(t,(0,n._)({styleType:c.Z.Type.Button},d(e,h.BD)))},e.Ghost=function(e){return s.createElement(t,(0,n._)({styleType:c.Z.Type.Button},d(e,h.fk)))},e.Tertiary=function(e){return s.createElement(t,(0,n._)({styleType:c.Z.Type.Base},d(e,h.UF)))},e.Flat=function(e){return s.createElement(t,d(e,h.$H))},e.White=function(e){return s.createElement(t,d(e,h.ix))},e.SidebarFlat=function(e){return s.createElement(p.Y,(0,n._)({styleType:c.Z.Type.H3Legacy},d(e,h.HN)))},e.Caps=function(e){return s.createElement(p.Y,(0,n._)({styleType:c.Z.Type.H3Legacy},d(e,h.Mp)))},e.Group=function(e){var t=e.children,i=e.className,r=e.align,m=void 0===r?"horizontal":r,c=e.sticky,p=e.name;return s.createElement(o.F.div,(0,a._)((0,n._)({role:"group"},(0,l.Sh)(i,"horizontal"===m?!0===c?h.vD:h.ru:h.oc)),{"data-name":p}),t)}}(u||(u={}));var _=function(e){var t=e.title,i=e.titleAlign,n=e.buttonClass,a=e.iconClass,m=e.iconWidth,c=e.tooltipClass;return s.createElement(u,{name:"info-button","aria-label":t,tag:p.X.div,title:s.createElement(o.F.div,(0,l.Sh)(h.bC,c),s.createElement("p",null,t)),titleAlign:i,className:n},s.createElement(r.JO.Info,{width:m,className:a}))}},94489:(e,t,i)=>{i.d(t,{x:()=>o});var n=i(68665),a=i(92964),s=i(86351);const o=n.forwardRef((function(e,t){const{as:i,className:o,variant:l="text-medium",color:m,align:c,weight:p,italic:h,decoration:u,margin:d,marginLeft:_,marginRight:g,marginTop:f,marginBottom:b,style:P,...v}=e,y={...P,...null!=m&&{color:`var(--color-text-${m})`},...null!=c&&{textAlign:c},...r(p),...null!=h&&{fontStyle:h?"italic":"normal"},...null!=u&&{textDecoration:u},...(0,s.AA)({margin:d,marginLeft:_,marginRight:g,marginTop:f,marginBottom:b})};return n.createElement(i,{ref:t,className:(0,a.W)("gds-typography","gds-"+(l.startsWith("heading")?"heading":"text"),`gds-${l}`,o),style:y,...v})})),l={bold:"bold",semibold:600,medium:500,normal:"normal"};function r(e){return null!=e&&l[e]?{fontWeight:l[e]}:null}},86351:(e,t,i)=>{function n(e){return.5===e?"half":.25===e?"quarter":`${e}`}function a({margin:e,marginLeft:t,marginRight:i,marginTop:n,marginBottom:a}){const s=l(e);return{marginLeft:o(t,s.left),marginRight:o(i,s.right),marginTop:o(n,s.top),marginBottom:o(a,s.bottom)}}function s({padding:e,paddingLeft:t,paddingRight:i,paddingTop:n,paddingBottom:a}){const s=l(e);return{paddingLeft:o(t,s.left),paddingRight:o(i,s.right),paddingTop:o(n,s.top),paddingBottom:o(a,s.bottom)}}function o(e,t){const i=void 0!==e?e:t;if(void 0!==i){if("string"==typeof i)return i;if(i<0){return`calc(var(--space-${n(-1*i)}) * -1)`}return`var(--space-${n(i)})`}}function l(e){if("string"!=typeof e)return{top:e,right:e,bottom:e,left:e};const t=e.split(" "),i=t[0],n=t[1]||i;return{top:i,right:n,bottom:t[2]||i,left:t[3]||n}}i.d(t,{AA:()=>a,Jy:()=>n,VI:()=>s})}}]);